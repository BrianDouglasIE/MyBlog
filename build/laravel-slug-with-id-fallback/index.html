<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!-- Meta Description -->
    <meta name="description" content="Slugs with an ID fallback in Laravel"/>

    <!-- Keywords -->
    <meta name="keywords" content="Brian Douglas, blog, laravel"/>

    <!-- Author -->
    <meta name="author" content="Brian Douglas"/>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="BrianDouglas.ie - Slugs with an ID fallback in Laravel"/>
    <meta property="og:description" content="Slugs with an ID fallback in Laravel"/>
    <meta property="og:url" content="https://www.briandouglas.ie"/>
    <meta property="og:image" content="http://www.briandouglas.ie/images/og-images/laravel-slug-with-id-fallback.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1280"/>
    <meta property="og:image:height" content="640"/>
    <meta property="og:site_name" content="BrianDouglas.ie"/>
    <meta property="og:image:alt" content="A preview image for the post titled 'Slugs with an ID fallback in Laravel'"/>

    <!-- Twitter Meta -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@BrianDouglasIE"/>
    <meta name="twitter:title" content="BrianDouglas.ie - Slugs with an ID fallback in Laravel"/>
    <meta name="twitter:description" content="Slugs with an ID fallback in Laravel"/>
    <meta name="twitter:image" content="http://www.briandouglas.ie/images/og-images/laravel-slug-with-id-fallback.png"/>

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.briandouglas.ie"/>

    <!-- Favicon (Optional) -->
    <link rel="icon" href="https://www.briandouglas.ie/favicon.ico" type="image/x-icon"/>

    <!-- Robots -->
    <meta name="robots" content="index, follow"/>

    <!-- Favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/site.webmanifest"/>

    <title>Slugs with an ID fallback in Laravel</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#24292e;background:#ffffff}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#d73a49}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#6f42c1}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#005cc5}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#032f62}.hljs-built_in,.hljs-symbol{color:#e36209}.hljs-code,.hljs-comment,.hljs-formula{color:#6a737d}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:bold}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:bold}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}.hljs-char.escape_,.hljs-link,.hljs-params,.hljs-property,.hljs-punctuation,.hljs-tag{}
    </style>
</head>
<body>

<div class="content">
    <header class="site-header">
    <a href="/" class="home">Brian Douglas</a>

    <div class="svg-container">
        <a href="https://github.com/BrianDouglasIE" class="github">
            <svg
                height="32"
                aria-hidden="true"
                viewBox="0 0 24 24"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M12.5.75C6.146.75 1 5.896 1 12.25c0 5.089 3.292 9.387 7.863 10.91.575.101.79-.244.79-.546 0-.273-.014-1.178-.014-2.142-2.889.532-3.636-.704-3.866-1.35-.13-.331-.69-1.352-1.18-1.625-.402-.216-.977-.748-.014-.762.906-.014 1.553.834 1.769 1.179 1.035 1.74 2.688 1.25 3.349.948.1-.747.402-1.25.733-1.538-2.559-.287-5.232-1.279-5.232-5.678 0-1.25.445-2.285 1.178-3.09-.115-.288-.517-1.467.115-3.048 0 0 .963-.302 3.163 1.179.92-.259 1.897-.388 2.875-.388.977 0 1.955.13 2.875.388 2.2-1.495 3.162-1.179 3.162-1.179.633 1.581.23 2.76.115 3.048.733.805 1.179 1.825 1.179 3.09 0 4.413-2.688 5.39-5.247 5.678.417.36.776 1.05.776 2.128 0 1.538-.014 2.774-.014 3.162 0 .302.216.662.79.547C20.709 21.637 24 17.324 24 12.25 24 5.896 18.854.75 12.5.75Z"
                ></path>
            </svg>
        </a>

        <a
            href="https://linkedin.com/in/brian-douglas-90abb93ab"
            class="linkedin"
        >
            <svg
                viewBox="0 0 128 128"
                height="32"
                aria-hidden="true"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M116 3H12a8.91 8.91 0 00-9 8.8v104.42a8.91 8.91 0 009 8.78h104a8.93 8.93 0 009-8.81V11.77A8.93 8.93 0 00116 3zM39.17 107H21.06V48.73h18.11zm-9-66.21a10.5 10.5 0 1110.49-10.5 10.5 10.5 0 01-10.54 10.48zM107 107H88.89V78.65c0-6.75-.12-15.44-9.41-15.44s-10.87 7.36-10.87 15V107H50.53V48.73h17.36v8h.24c2.42-4.58 8.32-9.41 17.13-9.41C103.6 47.28 107 59.35 107 75z"
                ></path>
            </svg>
        </a>
    </div>
</header>

    <div class="breadcrumbs">
        <a href="/">Home</a> / <span>Slugs with an ID fallback in Laravel</span>
    </div>

    <main>
        <article class="post">
            <header>
                <h1>Slugs with an ID fallback in Laravel</h1>
                <time datetime="12/06/2024">June 12th, 2024</time>
            </header>

            <div class="body">
                <p>Slugs make a URL look legit. No one wants to click on a link that reads like <code>https://mysite.com/blog/1</code>. I'd definitely get hacked if I clicked that. But what if it read <code>https://mysite.com/blog/1/some-awesome-content</code>. Now that looks trustworthy. I'm definitely gonna see some awesome content if I click that link.</p>
<!-- more -->
<h2 id="naiveway">Naive Way</h2>
<p>So how do we implement it? Well we could use the <code>blog</code> resource's title. Laravel provides a <code>Str::slug</code> helper which takes a string and <em>sluggifies</em> it. Meaning <code>My Awesome Blog Post</code> becomes <code>my-awesome-blog-post</code>. This seems like a great idea. Let's update our <code>Blog</code> model so that when it is saved it sets a <code>slug</code> value based on the title.</p>
<pre class="php language-php"><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Str</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">boot</span>();

        <span class="hljs-built_in">static</span>::<span class="hljs-title function_ invoke__">saving</span>(function (<span class="hljs-variable">$model</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$model</span>-&gt;slug)) {
                <span class="hljs-variable">$model</span>-&gt;slug = <span class="hljs-title class_">Str</span>::<span class="hljs-title function_ invoke__">slug</span>(<span class="hljs-variable">$model</span>-&gt;title);
            }
        });
    }
}
</code></pre>
<p>Now we can implement the resource's <code>show</code> route like so:</p>
<pre class="php language-php"><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$slug</span></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Blog</span>::<span class="hljs-title function_ invoke__">withSlug</span>(<span class="hljs-variable">$slug</span>)-&gt;<span class="hljs-title function_ invoke__">first</span>();
}
</code></pre>
<p>Awesome. What a completely foolproof implementation.</p>
<p><chicken-asks>
But what if we update the title?!?
</chicken-asks></p>
<p><magpie-replies>
If the title is updated the <code>slug</code> may no longer match the content.
</magpie-replies></p>
<p><chicken-asks>
Or worse, the <code>slug</code> might update too!
</chicken-asks></p>
<p><magpie-replies>
Then the previous url will return a 404, which may break embedded content.
</magpie-replies></p>
<h2 id="thesmartway">The Smart Way</h2>
<p>Yes, so not foolproof after all. The <code>title</code> of the blog may change. So it's not something we want to base our urls off, because we don't want our urls to change.</p>
<p>So what shouldn't change about our blog? it's id. At the start of this article we showed an ugly url <code>https://mysite.com/blog/1</code>. The good thing about this <em>ugly</em> url is it shouldn't change. By visiting it you will always view the blog with id 1. The downside is it's not descriptive. So let's combine the unique identifier of the id with the slug based of the blog's title. By doing this we get a url like so, <code>https://mysite.com/blog/1/my-awesome-content</code>. The trick here is that the slug part of the url is just for aesthetics. It gives the user an idea of what the blog with id 1 might be about. Let's implement this in Laravel so that the url works but uses the id solely to get the blog and redirects to the updated slug if the title changes.</p>
<h3 id="thecode">The Code</h3>
<p>We can achieve the above scenario like so. Firstly, in our routes file we will specify the following show route.</p>
<pre class="php language-php"><code class="hljs php language-php"><span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;blog/{blog}/{slug?}&#x27;</span>, [<span class="hljs-title class_">BlogController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;show&#x27;</span>])-&gt;<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;blog.show&#x27;</span>);
</code></pre>
<p>Now we'll update our <code>Blog</code> model to contain a helper method, that constructs the new show route.</p>
<pre class="php language-php"><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Str</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showRoute</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$parameters</span> = []</span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">route</span>(<span class="hljs-string">&#x27;blog.show&#x27;</span>, [<span class="hljs-variable">$this</span>, <span class="hljs-title class_">Str</span>::<span class="hljs-title function_ invoke__">slug</span>(<span class="hljs-variable">$this</span>-&gt;title), ...<span class="hljs-variable">$parameters</span>]);
    }
}
</code></pre>
<p>Finally, in the <code>show</code> method of our <code>BlogController</code> we will add the following.</p>
<pre class="php language-php"><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, Blog <span class="hljs-variable">$blog</span></span>)
</span>{
    <span class="hljs-keyword">if</span> (! <span class="hljs-title class_">Str</span>::<span class="hljs-title function_ invoke__">contains</span>(<span class="hljs-variable">$blog</span>-&gt;<span class="hljs-title function_ invoke__">showRoute</span>(), <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">path</span>())) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-variable">$blog</span>-&gt;<span class="hljs-title function_ invoke__">showRoute</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">query</span>()), <span class="hljs-attr">status</span>: <span class="hljs-number">301</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;blog.show&#x27;</span>, <span class="hljs-title function_ invoke__">compact</span>(<span class="hljs-string">&#x27;blog&#x27;</span>));
}
</code></pre>
<p>In the above <code>show</code> method, Laravel's route model binding is used to find the correct blog based on the id supplied. We then add an extra check to make sure the <code>$request-&gt;path()</code> matches the <code>showRoute()</code>. If it does not we redirect to the correct <code>showRoute()</code> with a status of <code>301 Moved Permanently</code> to let the browser know the slug has updated.</p>
            </div>

            <footer>
                <p><i>Until next time,</i></p>
                <p><i>Brian</i></p>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
    <p>
        <small>Since August 4th, 2023. All words by Brian
            Douglas. <a href="mailto:brianwdouglas@proton.me">Have a comment?</a></small>
    </p>
</footer>

</div>

<script src="/scripts/chicken-and-magpie.js"></script>
<script src="/scripts/skip-to-section.js"></script>
</body>
</html>
