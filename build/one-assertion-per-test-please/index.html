<!doctype html>
<html lang="en">
    <head>
        <!-- Google tag (gtag.js) -->
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-SXTREFVFLB"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());

            gtag("config", "G-SXTREFVFLB");
        </script>

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <!-- Meta Description -->
        <meta name="description" content="One assertion per test please" />

        <!-- Keywords -->
        <meta
            name="keywords"
            content="Brian Douglas, blog, js,testing"
        />

        <!-- Author -->
        <meta name="author" content="Brian Douglas" />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta
            property="og:title"
            content="BrianDouglas.ie - One assertion per test please"
        />
        <meta property="og:description" content="One assertion per test please" />
        <meta property="og:url" content="https://www.briandouglas.ie" />
        <meta
            property="og:image"
            content="http://www.briandouglas.ie/images/og-images/one-assertion-per-test-please.png"
        />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="1280" />
        <meta property="og:image:height" content="640" />
        <meta property="og:site_name" content="BrianDouglas.ie" />
        <meta
            property="og:image:alt"
            content="A preview image for the post titled 'One assertion per test please'"
        />

        <!-- Twitter Meta -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@BrianDouglasIE" />
        <meta
            name="twitter:title"
            content="BrianDouglas.ie - One assertion per test please"
        />
        <meta name="twitter:description" content="One assertion per test please" />
        <meta
            name="twitter:image"
            content="http://www.briandouglas.ie/images/og-images/one-assertion-per-test-please.png"
        />

        <!-- Canonical URL -->
        <link rel="canonical" href="https://www.briandouglas.ie" />

        <!-- Favicon (Optional) -->
        <link
            rel="icon"
            href="https://www.briandouglas.ie/favicon.ico"
            type="image/x-icon"
        />

        <!-- Robots -->
        <meta name="robots" content="index, follow" />

        <!-- Favicon-->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link rel="manifest" href="/site.webmanifest" />

        <title>One assertion per test please</title>
        <link rel="stylesheet" href="/styles.css" />
        <style>
            pre code.hljs {
                display: block;
                overflow-x: auto;
                padding: 1em;
            }
            code.hljs {
                padding: 3px 5px;
            }
            .hljs {
                color: #24292e;
                background: #ffffff;
            }
            .hljs-doctag,
            .hljs-keyword,
            .hljs-meta .hljs-keyword,
            .hljs-template-tag,
            .hljs-template-variable,
            .hljs-type,
            .hljs-variable.language_ {
                color: #d73a49;
            }
            .hljs-title,
            .hljs-title.class_,
            .hljs-title.class_.inherited__,
            .hljs-title.function_ {
                color: #6f42c1;
            }
            .hljs-attr,
            .hljs-attribute,
            .hljs-literal,
            .hljs-meta,
            .hljs-number,
            .hljs-operator,
            .hljs-selector-attr,
            .hljs-selector-class,
            .hljs-selector-id,
            .hljs-variable {
                color: #005cc5;
            }
            .hljs-meta .hljs-string,
            .hljs-regexp,
            .hljs-string {
                color: #032f62;
            }
            .hljs-built_in,
            .hljs-symbol {
                color: #e36209;
            }
            .hljs-code,
            .hljs-comment,
            .hljs-formula {
                color: #6a737d;
            }
            .hljs-name,
            .hljs-quote,
            .hljs-selector-pseudo,
            .hljs-selector-tag {
                color: #22863a;
            }
            .hljs-subst {
                color: #24292e;
            }
            .hljs-section {
                color: #005cc5;
                font-weight: bold;
            }
            .hljs-bullet {
                color: #735c0f;
            }
            .hljs-emphasis {
                color: #24292e;
                font-style: italic;
            }
            .hljs-strong {
                color: #24292e;
                font-weight: bold;
            }
            .hljs-addition {
                color: #22863a;
                background-color: #f0fff4;
            }
            .hljs-deletion {
                color: #b31d28;
                background-color: #ffeef0;
            }
            .hljs-char.escape_,
            .hljs-link,
            .hljs-params,
            .hljs-property,
            .hljs-punctuation,
            .hljs-tag {
            }
        </style>
    </head>
    <body>
        <div class="content">
            <header class="site-header">
    <a href="/" class="home">Brian Douglas</a>

    <div class="svg-container">
        <a href="https://github.com/BrianDouglasIE" class="github">
            <svg
                height="32"
                aria-hidden="true"
                viewBox="0 0 24 24"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M12.5.75C6.146.75 1 5.896 1 12.25c0 5.089 3.292 9.387 7.863 10.91.575.101.79-.244.79-.546 0-.273-.014-1.178-.014-2.142-2.889.532-3.636-.704-3.866-1.35-.13-.331-.69-1.352-1.18-1.625-.402-.216-.977-.748-.014-.762.906-.014 1.553.834 1.769 1.179 1.035 1.74 2.688 1.25 3.349.948.1-.747.402-1.25.733-1.538-2.559-.287-5.232-1.279-5.232-5.678 0-1.25.445-2.285 1.178-3.09-.115-.288-.517-1.467.115-3.048 0 0 .963-.302 3.163 1.179.92-.259 1.897-.388 2.875-.388.977 0 1.955.13 2.875.388 2.2-1.495 3.162-1.179 3.162-1.179.633 1.581.23 2.76.115 3.048.733.805 1.179 1.825 1.179 3.09 0 4.413-2.688 5.39-5.247 5.678.417.36.776 1.05.776 2.128 0 1.538-.014 2.774-.014 3.162 0 .302.216.662.79.547C20.709 21.637 24 17.324 24 12.25 24 5.896 18.854.75 12.5.75Z"
                ></path>
            </svg>
        </a>

        <a
            href="https://linkedin.com/in/brian-douglas-90abb93ab"
            class="linkedin"
        >
            <svg
                viewBox="0 0 128 128"
                height="32"
                aria-hidden="true"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M116 3H12a8.91 8.91 0 00-9 8.8v104.42a8.91 8.91 0 009 8.78h104a8.93 8.93 0 009-8.81V11.77A8.93 8.93 0 00116 3zM39.17 107H21.06V48.73h18.11zm-9-66.21a10.5 10.5 0 1110.49-10.5 10.5 10.5 0 01-10.54 10.48zM107 107H88.89V78.65c0-6.75-.12-15.44-9.41-15.44s-10.87 7.36-10.87 15V107H50.53V48.73h17.36v8h.24c2.42-4.58 8.32-9.41 17.13-9.41C103.6 47.28 107 59.35 107 75z"
                ></path>
            </svg>
        </a>
    </div>
</header>

            <div class="breadcrumbs">
                <a href="/">Home</a> / <span>One assertion per test please</span>
            </div>

            <main>
                <article class="post">
                    <header>
                        <h1>One assertion per test please</h1>
                        <time datetime="17/08/2024"
                            >August 17th, 2024</time
                        >
                    </header>

                    <div class="body"><p>Please! when you are writing tests try to limit each test case to one <code>expect</code>.
Let's refactor the monstrosity below to understand why fewer expects and more 
tests are better.</p>
<!-- more -->
<p><magpie-trinket>
Try your best to write test cases as if they were telling a story.
Stick to one assertion per test, and split out any shared logic into
hooks, like <code>beforeEach</code> and <code>beforeAll</code>.
</magpie-trinket></p>
<h2 id="themonstrosity">The Monstrosity</h2>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">import</span> { render, screen, fireEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react&#x27;</span>;
<span class="hljs-keyword">import</span> { expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vitest&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MyComponent&#x27;</span>;

<span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;User Name Submit Form&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> mockApiData = { <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> };
  <span class="hljs-keyword">const</span> apiFetchMock = vi.<span class="hljs-title function_">fn</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(mockApiData));

  <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> <span class="hljs-attr">fetchData</span>=<span class="hljs-string">{apiFetchMock}</span> /&gt;</span></span>);

  <span class="hljs-keyword">const</span> header = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-regexp">/My Dashboard/i</span>);
  <span class="hljs-title function_">expect</span>(header).<span class="hljs-title function_">toBeInTheDocument</span>();

  <span class="hljs-keyword">const</span> button = screen.<span class="hljs-title function_">getByRole</span>(<span class="hljs-string">&#x27;button&#x27;</span>, { <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Submit/i</span> });
  <span class="hljs-title function_">expect</span>(button).<span class="hljs-title function_">toBeInTheDocument</span>();
  <span class="hljs-title function_">expect</span>(button).<span class="hljs-title function_">toBeDisabled</span>();

  <span class="hljs-keyword">const</span> input = screen.<span class="hljs-title function_">getByPlaceholderText</span>(<span class="hljs-string">&#x27;Enter your name&#x27;</span>);
  <span class="hljs-title function_">expect</span>(input).<span class="hljs-title function_">toBeInTheDocument</span>();
  <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;&#x27;</span>);

  fireEvent.<span class="hljs-title function_">change</span>(input, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> } });
  <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;John Doe&#x27;</span>);

  <span class="hljs-title function_">expect</span>(button).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeDisabled</span>();

  fireEvent.<span class="hljs-title function_">click</span>(button);

  <span class="hljs-keyword">const</span> successMessage = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-regexp">/Success!/i</span>);
  <span class="hljs-title function_">expect</span>(successMessage).<span class="hljs-title function_">toBeInTheDocument</span>();
});
</code></pre>
<p>Now you wouldn't know it at first glance but the above test case is used to validate
a form where the user can submit their name. The test technically works, but it does
not communicate it's intent.</p>
<p>I see code like this all the time. Especially when working with UI frameworks like
React, Angular, and Vue. Developers pile assertion upon assertion into one large 
test case. And when a new requirement comes along? they just add in yet another
assertion.</p>
<p>Why? because the set-up is <em>done</em>, and bulky, and they don't want to have to rewrite
or duplicate the work.</p>
<p><chicken-asks>
So how do we fix this?
</chicken-asks></p>
<p><magpie-replies>
We break out each assertion into its own test.
</magpie-replies></p>
<h2 id="therefactor">The Refactor</h2>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">import</span> { render, screen, fireEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react&#x27;</span>;
<span class="hljs-keyword">import</span> { beforeEach, expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vitest&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./MyComponent&#x27;</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;User Name Submit Form&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> apiFetchMock;

    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> mockApiData = { <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> };
        apiFetchMock = vi.<span class="hljs-title function_">fn</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(mockApiData));

        <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> <span class="hljs-attr">fetchData</span>=<span class="hljs-string">{apiFetchMock}</span> /&gt;</span></span>);
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;renders header&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> header = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-regexp">/My Dashboard/i</span>);
        <span class="hljs-title function_">expect</span>(header).<span class="hljs-title function_">toBeInTheDocument</span>();
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;renders input field&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> input = screen.<span class="hljs-title function_">getByPlaceholderText</span>(<span class="hljs-string">&#x27;Enter your name&#x27;</span>);
        <span class="hljs-title function_">expect</span>(input).<span class="hljs-title function_">toBeInTheDocument</span>();
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;initial input field is empty&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> input = screen.<span class="hljs-title function_">getByPlaceholderText</span>(<span class="hljs-string">&#x27;Enter your name&#x27;</span>);
        <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;changes input value on user input&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> input = screen.<span class="hljs-title function_">getByPlaceholderText</span>(<span class="hljs-string">&#x27;Enter your name&#x27;</span>);
        fireEvent.<span class="hljs-title function_">change</span>(input, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> } });
        <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;John Doe&#x27;</span>);
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;renders submit button&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> button = screen.<span class="hljs-title function_">getByRole</span>(<span class="hljs-string">&#x27;button&#x27;</span>, { <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Submit/i</span> });
        <span class="hljs-title function_">expect</span>(button).<span class="hljs-title function_">toBeInTheDocument</span>();
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;submit button is disabled initially&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> button = screen.<span class="hljs-title function_">getByRole</span>(<span class="hljs-string">&#x27;button&#x27;</span>, { <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Submit/i</span> });
        <span class="hljs-title function_">expect</span>(button).<span class="hljs-title function_">toBeDisabled</span>();
    });

    <span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;submit button is enabled after input change&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> input = screen.<span class="hljs-title function_">getByPlaceholderText</span>(<span class="hljs-string">&#x27;Enter your name&#x27;</span>);
        fireEvent.<span class="hljs-title function_">change</span>(input, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> } });
        <span class="hljs-keyword">const</span> button = screen.<span class="hljs-title function_">getByRole</span>(<span class="hljs-string">&#x27;button&#x27;</span>, { <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Submit/i</span> });
        <span class="hljs-title function_">expect</span>(button).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeDisabled</span>();
    });
});
</code></pre>
<p>In the above refactor any shared test set up is broken out into a <code>beforeEach</code> hook
and each assertion is given its own test case.</p>
<p>The advantage of doing this becomes immediately clear. The tests now read like a 
story. We know exactly what the intent of each test case is, and  we only have to
read a small amount of code to understand the test's logic. To accentuate my point
about read ability. If we were to take the name of each test case and list it out
we would have the following verse.</p>
<pre><code class="hljs"><span class="hljs-keyword">User</span> <span class="hljs-type">Name</span> Submit Form
    renders <span class="hljs-keyword">header</span>
    renders <span class="hljs-keyword">input</span> field
    initial <span class="hljs-keyword">input</span> field <span class="hljs-keyword">is</span> empty
    changes <span class="hljs-keyword">input</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">input</span>
    renders submit button
    submit button <span class="hljs-keyword">is</span> disabled <span class="hljs-keyword">initially</span>
    submit button <span class="hljs-keyword">is</span> enabled <span class="hljs-keyword">after</span> <span class="hljs-keyword">input</span> change
</code></pre>
<p>This reads like a list of requirements. Which is essentially what UI tests are.
Compare this with the story the initial test gave us.</p>
<pre><code class="hljs"><span class="hljs-keyword">User</span> <span class="hljs-title">Name</span> Submit Form
</code></pre>
<p>Yea, not as descriptive. Who knows what that test does. Not me.</p>
<p>So in summary, try your best to write your test cases as if they were telling a 
story. Try to stick to one assertion per test, and split out any shared logic into
hooks, like <code>beforeEach</code> and <code>beforeAll</code>.</p></div>

                    <footer>
                        <p><i>Until next time,</i></p>
                        <p><i>Brian</i></p>
                    </footer>
                </article>
            </main>

            <footer class="site-footer">
    <p>
        <small>Since August 4th, 2023. All words by Brian
            Douglas. <a href="mailto:brianwdouglas@proton.me">Have a comment?</a></small>
    </p>
</footer>

        </div>

        <script src="/scripts/chicken-and-magpie.js"></script>
        <script src="/scripts/skip-to-section.js"></script>
    </body>
</html>
