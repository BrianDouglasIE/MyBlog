<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!-- Meta Description -->
    <meta name="description" content="Prevent pixel art blur on canvas"/>

    <!-- Keywords -->
    <meta name="keywords" content="Brian Douglas, blog, js,canvas"/>

    <!-- Author -->
    <meta name="author" content="Brian Douglas"/>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="BrianDouglas.ie - Prevent pixel art blur on canvas"/>
    <meta property="og:description" content="Prevent pixel art blur on canvas"/>
    <meta property="og:url" content="https://www.briandouglas.ie"/>
    <meta property="og:image" content="http://www.briandouglas.ie/images/og-images/draw-pixel-art-on-canvas.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1280"/>
    <meta property="og:image:height" content="640"/>
    <meta property="og:site_name" content="BrianDouglas.ie"/>
    <meta property="og:image:alt" content="A preview image for the post titled 'Prevent pixel art blur on canvas'"/>

    <!-- Twitter Meta -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@BrianDouglasIE"/>
    <meta name="twitter:title" content="BrianDouglas.ie - Prevent pixel art blur on canvas"/>
    <meta name="twitter:description" content="Prevent pixel art blur on canvas"/>
    <meta name="twitter:image" content="http://www.briandouglas.ie/images/og-images/draw-pixel-art-on-canvas.png"/>

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.briandouglas.ie"/>

    <!-- Favicon (Optional) -->
    <link rel="icon" href="https://www.briandouglas.ie/favicon.ico" type="image/x-icon"/>

    <!-- Robots -->
    <meta name="robots" content="index, follow"/>

    <!-- Favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/site.webmanifest"/>

    <title>Prevent pixel art blur on canvas</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#24292e;background:#ffffff}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#d73a49}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#6f42c1}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#005cc5}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#032f62}.hljs-built_in,.hljs-symbol{color:#e36209}.hljs-code,.hljs-comment,.hljs-formula{color:#6a737d}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:bold}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:bold}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}.hljs-char.escape_,.hljs-link,.hljs-params,.hljs-property,.hljs-punctuation,.hljs-tag{}
    </style>
</head>
<body>

<div class="content">
    <header class="site-header">
    <a href="/" class="home">Brian Douglas</a>

    <div class="svg-container">
        <a href="https://github.com/BrianDouglasIE" class="github">
            <svg
                height="32"
                aria-hidden="true"
                viewBox="0 0 24 24"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M12.5.75C6.146.75 1 5.896 1 12.25c0 5.089 3.292 9.387 7.863 10.91.575.101.79-.244.79-.546 0-.273-.014-1.178-.014-2.142-2.889.532-3.636-.704-3.866-1.35-.13-.331-.69-1.352-1.18-1.625-.402-.216-.977-.748-.014-.762.906-.014 1.553.834 1.769 1.179 1.035 1.74 2.688 1.25 3.349.948.1-.747.402-1.25.733-1.538-2.559-.287-5.232-1.279-5.232-5.678 0-1.25.445-2.285 1.178-3.09-.115-.288-.517-1.467.115-3.048 0 0 .963-.302 3.163 1.179.92-.259 1.897-.388 2.875-.388.977 0 1.955.13 2.875.388 2.2-1.495 3.162-1.179 3.162-1.179.633 1.581.23 2.76.115 3.048.733.805 1.179 1.825 1.179 3.09 0 4.413-2.688 5.39-5.247 5.678.417.36.776 1.05.776 2.128 0 1.538-.014 2.774-.014 3.162 0 .302.216.662.79.547C20.709 21.637 24 17.324 24 12.25 24 5.896 18.854.75 12.5.75Z"
                ></path>
            </svg>
        </a>

        <a
            href="https://linkedin.com/in/brian-douglas-90abb93ab"
            class="linkedin"
        >
            <svg
                viewBox="0 0 128 128"
                height="32"
                aria-hidden="true"
                width="32"
                data-view-component="true"
            >
                <path
                    d="M116 3H12a8.91 8.91 0 00-9 8.8v104.42a8.91 8.91 0 009 8.78h104a8.93 8.93 0 009-8.81V11.77A8.93 8.93 0 00116 3zM39.17 107H21.06V48.73h18.11zm-9-66.21a10.5 10.5 0 1110.49-10.5 10.5 10.5 0 01-10.54 10.48zM107 107H88.89V78.65c0-6.75-.12-15.44-9.41-15.44s-10.87 7.36-10.87 15V107H50.53V48.73h17.36v8h.24c2.42-4.58 8.32-9.41 17.13-9.41C103.6 47.28 107 59.35 107 75z"
                ></path>
            </svg>
        </a>
    </div>
</header>

    <div class="breadcrumbs">
        <a href="/">Home</a> / <span>Prevent pixel art blur on canvas</span>
    </div>

    <main>
        <article class="post">
            <header>
                <h1>Prevent pixel art blur on canvas</h1>
                <time datetime="15/10/2024">October 15th, 2024</time>
            </header>

            <div class="body">
                <p>Nobody wants to see blurry pixel art rendered in a game. So let's investigate
how to render crisp pixel art images on a canvas element.</p>
<!-- more -->
<p><magpie-trinket>
Full source code for this article is available at <a href="https://github.com/BrianDouglasIE/canvas-pixel-art">BrianDouglasIE/canvas-pixel-art</a>
</magpie-trinket></p>
<h2 id="thetaskathand">The task at hand</h2>
<p>So for this demo let's say we want to render the sprite of our game's hero character
on a canvas. The sprite sheet that I will be using is from KenneyNL, it's the 1-Bit
monochrome asset pack. Each sprite in the canvas is 16x16 pixels in dimension. This 
will be scaled up to around 4 times it's original size.</p>
<p>I want my canvas to be 640x480 pixels in dimension. If I were to draw a sprite
directly on the canvas it would look miniscule. If I were to draw it at 4 times it's
original size, it would look blurry. So the question is, how do I draw my scaled up
pixel art character without causing it to blur.</p>
<p><chicken-asks>I bet this complex problem requires a complex solution</chicken-asks>
<magpie-replies>I bet the solution is a one liner</magpie-replies></p>
<h2 id="someboilerplate">Some boiler plate</h2>
<p>Before I even get as far as rendering my pixel art character on a canvas there is some
initial boilerplate code that is needed.</p>
<p>Firstly I'll need to create a canvas element to render the game on. I can do that with
the following code. Which creates the canvas and appends it to the document's body. I 
also set the canvas' width and height to be a quarter of the intended size. I will scale
this up later.</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>)
<span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>)
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(canvas)
canvas.<span class="hljs-property">height</span> = <span class="hljs-number">120</span>
canvas.<span class="hljs-property">width</span> = <span class="hljs-number">160</span>
</code></pre>
<p>Once this is in place I will add some functions to render the sprite sheet and extract the
image data of the sprite that I want to render. To do this I create a separate canvas. This
canvas will not be appended to the body of the html document as the user will never see it.
Instead it will be used to draw the sprite sheet in it's entirety. I will then grab the
individual sprites from it as and when they are needed. I also set the canvas to be scaled
up the target size using CSS. The code for this is below.</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">const</span> spriteCellSize = <span class="hljs-number">16</span>
<span class="hljs-keyword">const</span> spriteSheet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()
spriteSheet.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">&quot;anonymous&quot;</span>
spriteSheet.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;load&quot;</span>, onLoad, <span class="hljs-literal">false</span>)
spriteSheet.<span class="hljs-property">src</span> = <span class="hljs-string">&quot;./monochrome-transparent.png&quot;</span>

<span class="hljs-keyword">const</span> scale = <span class="hljs-number">4</span>
canvas.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${canvas.width * scale}</span>px`</span>
canvas.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${canvas.height * scale}</span>px`</span>

<span class="hljs-keyword">const</span> spriteSheetCanvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>)

<span class="hljs-keyword">let</span> heroSprite = <span class="hljs-literal">undefined</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (!heroSprite) {
    spriteSheetCanvas.<span class="hljs-property">width</span> = spriteSheet.<span class="hljs-property">width</span>
    spriteSheetCanvas.<span class="hljs-property">height</span> = spriteSheet.<span class="hljs-property">height</span>
    <span class="hljs-keyword">const</span> spriteSheetContext = spriteSheetCanvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>)
    <span class="hljs-title function_">clearScreen</span>(spriteSheetContext, spriteSheetCanvas.<span class="hljs-property">width</span>, spriteSheetCanvas.<span class="hljs-property">height</span>)
    <span class="hljs-title function_">drawSpriteSheet</span>(spriteSheetContext, spriteSheet)
    heroSprite = <span class="hljs-title function_">getSpriteSheetCell</span>(spriteSheetContext, spriteCellSize, <span class="hljs-number">26</span>, <span class="hljs-number">0</span>)
  }

  <span class="hljs-title function_">clearScreen</span>(ctx, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>)
  ctx.<span class="hljs-title function_">putImageData</span>(heroSprite, canvas.<span class="hljs-property">width</span> / <span class="hljs-number">2</span> - spriteCellSize / <span class="hljs-number">2</span>, canvas.<span class="hljs-property">height</span> / <span class="hljs-number">2</span> - spriteCellSize / <span class="hljs-number">2</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">clearScreen</span>(<span class="hljs-params">ctx, w, h</span>) {
  ctx.<span class="hljs-title function_">save</span>()
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;black&quot;</span>
  ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h)
  ctx.<span class="hljs-title function_">restore</span>()
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">drawSpriteSheet</span>(<span class="hljs-params">ctx, spriteSheet</span>) {
  ctx.<span class="hljs-title function_">drawImage</span>(spriteSheet, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSpriteSheetCell</span>(<span class="hljs-params">ctx, spriteCellSize, col, row</span>) {
  <span class="hljs-keyword">const</span> x = spriteCellSize * col
  <span class="hljs-keyword">const</span> y = spriteCellSize * row
  <span class="hljs-keyword">return</span> ctx.<span class="hljs-title function_">getImageData</span>(x, y, spriteCellSize, spriteCellSize)
}
</code></pre>
<p>Here is what is rendered on the canvas. As you can see it is super blurry.</p>
<p><img src="/images/blurry-sprite-render.png" alt="blurry sprite render" /></p>
<h2 id="thesolution">The solution</h2>
<p>One line of CSS fixes this. Setting the <code>image-rendering</code> property on the canvas to be <code>pixelated</code>.
In the demo code this can be done by adding the following statement at line 10.</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript">canvas.<span class="hljs-property">style</span>.<span class="hljs-property">imageRendering</span> = <span class="hljs-string">&quot;pixelated&quot;</span>
</code></pre>
<p>The canvas now renders a crisp sprite.</p>
<p><img src="/images/crisp-sprite-render.png" alt="crisp sprite render" /></p>
            </div>

            <footer>
                <p><i>Until next time,</i></p>
                <p><i>Brian</i></p>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
    <p>
        <small>Since August 4th, 2023. All words by Brian
            Douglas. <a href="mailto:brianwdouglas@proton.me">Have a comment?</a></small>
    </p>
</footer>

</div>

<script src="/scripts/chicken-and-magpie.js"></script>
<script src="/scripts/skip-to-section.js"></script>
</body>
</html>
