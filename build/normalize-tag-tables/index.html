<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!-- Meta Description -->
    <meta name="description" content="Modeling Tags in a Postgres schema"/>

    <!-- Keywords -->
    <meta name="keywords" content="Brian Douglas, blog, sql,postgres"/>

    <!-- Author -->
    <meta name="author" content="Brian Douglas"/>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="BrianDouglas.ie - Modeling Tags in a Postgres schema"/>
    <meta property="og:description" content="Modeling Tags in a Postgres schema"/>
    <meta property="og:url" content="https://www.briandouglas.ie"/>
    <meta property="og:image" content="http://www.briandouglas.ie/images/og-images/normalize-tag-tables.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1280"/>
    <meta property="og:image:height" content="640"/>
    <meta property="og:site_name" content="BrianDouglas.ie"/>
    <meta property="og:image:alt" content="A preview image for the post titled 'Modeling Tags in a Postgres schema'"/>

    <!-- Twitter Meta -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@BrianDouglasIE"/>
    <meta name="twitter:title" content="BrianDouglas.ie - Modeling Tags in a Postgres schema"/>
    <meta name="twitter:description" content="Modeling Tags in a Postgres schema"/>
    <meta name="twitter:image" content="http://www.briandouglas.ie/images/og-images/normalize-tag-tables.png"/>

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.briandouglas.ie"/>

    <!-- Favicon (Optional) -->
    <link rel="icon" href="https://www.briandouglas.ie/favicon.ico" type="image/x-icon"/>

    <!-- Robots -->
    <meta name="robots" content="index, follow"/>

    <!-- Favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
    <link rel="manifest" href="/site.webmanifest"/>

    <title>Modeling Tags in a Postgres schema</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#24292e;background:#ffffff}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#d73a49}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#6f42c1}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#005cc5}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#032f62}.hljs-built_in,.hljs-symbol{color:#e36209}.hljs-code,.hljs-comment,.hljs-formula{color:#6a737d}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:bold}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:bold}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}.hljs-char.escape_,.hljs-link,.hljs-params,.hljs-property,.hljs-punctuation,.hljs-tag{}
    </style>
</head>
<body>

<div class="content">
    <header class="site-header">
    <a href="/" class="home">Brian Douglas</a>

    <a href="https://github.com/BrianDouglasIE" class="github">
        <svg
                height="32"
                aria-hidden="true"
                viewBox="0 0 24 24"
                width="32"
                data-view-component="true"
        >
            <path
                    d="M12.5.75C6.146.75 1 5.896 1 12.25c0 5.089 3.292 9.387 7.863 10.91.575.101.79-.244.79-.546 0-.273-.014-1.178-.014-2.142-2.889.532-3.636-.704-3.866-1.35-.13-.331-.69-1.352-1.18-1.625-.402-.216-.977-.748-.014-.762.906-.014 1.553.834 1.769 1.179 1.035 1.74 2.688 1.25 3.349.948.1-.747.402-1.25.733-1.538-2.559-.287-5.232-1.279-5.232-5.678 0-1.25.445-2.285 1.178-3.09-.115-.288-.517-1.467.115-3.048 0 0 .963-.302 3.163 1.179.92-.259 1.897-.388 2.875-.388.977 0 1.955.13 2.875.388 2.2-1.495 3.162-1.179 3.162-1.179.633 1.581.23 2.76.115 3.048.733.805 1.179 1.825 1.179 3.09 0 4.413-2.688 5.39-5.247 5.678.417.36.776 1.05.776 2.128 0 1.538-.014 2.774-.014 3.162 0 .302.216.662.79.547C20.709 21.637 24 17.324 24 12.25 24 5.896 18.854.75 12.5.75Z"
            ></path>
        </svg>
    </a>
</header>
    <div class="breadcrumbs">
        <a href="/">Home</a> / <span>Modeling Tags in a Postgres schema</span>
    </div>

    <main>
        <article class="post">
            <header>
                <h1>Modeling Tags in a Postgres schema</h1>
                <time datetime="16/02/2026">February 16th, 2026</time>
            </header>

            <div class="body">
                <p>When working on a db schema to model the <a href="https://ogp.me">OpenGraph protocol</a> I made an initial mistake with
how I modelled tags within the database.</p>
<!-- more -->
<p>The OpenGraph protocol is used to supply information about web pages in a predictable format. This is useful
as sites can use the protocol to create things such as the link previews you will have seen on social media.
The protocol specifies many data points, and has a concept of <em>data types</em>. For example you can have a web page
for a movie. This would be represented by the <em>video.movie</em> type in the protocol. This can contain nested types
like <em>video:actor</em> and <em>video:director</em>, so it's perfect for modeling in a relational database.</p>
<p>Quite a few of these entities can contain <em>tags</em>, which are represented by strings. Initially I opted for a simple pivot
table for each instance of a tag. This was a mistake as I ended up having to create many tables along the lines of
<code>og_book_tag</code> and <code>og_article_tag</code> for example.</p>
<p>As always if something feels wrong it usually is. I took a quick look over the schema and realised that the initial
<em>og</em>object_ (which is the parent entity) is referenced in each of these child tables, 
and as such I could create an <em>og</em>tags_ table to track all the tags as I have done below.</p>
<pre class="sql language-sql"><code class="hljs sql language-sql"><span class="hljs-keyword">create table</span> og_tags (
    id <span class="hljs-type">bigint</span> generated always <span class="hljs-keyword">as</span> <span class="hljs-keyword">identity</span> <span class="hljs-keyword">primary key</span>,
    og_object_id <span class="hljs-type">bigint</span> <span class="hljs-keyword">not null</span> <span class="hljs-keyword">references</span> og_objects(id) <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> cascade,
    tag text <span class="hljs-keyword">not null</span>,
    created_at timestamptz <span class="hljs-keyword">not null</span> <span class="hljs-keyword">default</span> now(),
    <span class="hljs-keyword">primary key</span>(og_object_id, tag)
);

<span class="hljs-comment">-- always remember to add your indices</span>
<span class="hljs-keyword">create</span> index idx_og_tags_og_object_id <span class="hljs-keyword">on</span> og_tags(og_object_id);
<span class="hljs-keyword">create</span> index idx_og_tags_tag <span class="hljs-keyword">on</span> og_tags(tag);
</code></pre>
<p>Now I can select the tags relevant to an entity using joins. </p>
<p>In the example below I get the tags for the <em>og</em>video<em>movies</em> related to the <em>og</em>object_ 
with an id of <code>123</code>. This means that I can delete all the redundant pivot tables I had initially created.</p>
<pre class="sql language-sql"><code class="hljs sql language-sql"><span class="hljs-keyword">SELECT</span> t.tag
<span class="hljs-keyword">FROM</span> og_tags t
<span class="hljs-keyword">JOIN</span> og_objects o <span class="hljs-keyword">ON</span> t.og_object_id <span class="hljs-operator">=</span> o.id
<span class="hljs-keyword">JOIN</span> og_video_movies vm <span class="hljs-keyword">ON</span> vm.og_object_id <span class="hljs-operator">=</span> o.id
<span class="hljs-keyword">WHERE</span> vm.og_object_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>; 
</code></pre>
            </div>

            <footer>
                <p><i>Until next time,</i></p>
                <p><i>Brian</i></p>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
    <p>
        <small>Since August 4th, 2023. All words by Brian
            Douglas. <a href="mailto:brianwdouglas@proton.me">Have a comment?</a></small>
    </p>
</footer>

</div>

<script src="/scripts/chicken-and-magpie.js"></script>
<script src="/scripts/skip-to-section.js"></script>
</body>
</html>
